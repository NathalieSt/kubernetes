
        # WebSocket upgrade mapping
        map $http_upgrade $connection_upgrade {
            default upgrade;
            '' close;
        }

        ## Set a variable to help us decide if we need to add the
        ## 'Docker-Distribution-Api-Version' header.
        ## The registry always sets this header.
        ## In the case of nginx performing auth, the header is unset
        ## since nginx is auth-ing before proxying.
        map $upstream_http_docker_distribution_api_version $docker_distribution_api_version {
            '' 'registry/2.0';
        }

         
    upstream jellyfin {
        server jellyfin.jellyfin.svc.cluster.local:8096;
    }
    
 
    upstream vault {
        server vault.vault.svc.cluster.local:8200;
    }
    
 
    upstream gatus_config {
        server gatus_config.gatus_config.svc.cluster.local:80;
    }
    
 
    upstream wikijs {
        server wikijs.wikijs.svc.cluster.local:80;
    }
    
 
    upstream searxng {
        server searxng.searxng.svc.cluster.local:8080;
    }
    
 
    upstream dawarich {
        server dawarich.dawarich.svc.cluster.local:3000;
    }
    
 
    upstream registry {
        server registry.registry.svc.cluster.local:5000;
    }
    
        server {
            listen 80;
            server_name jellyfin.cluster.netbird.selfhosted,vault.cluster.netbird.selfhosted,gatus_config.cluster.netbird.selfhosted,wikijs.cluster.netbird.selfhosted,searxng.cluster.netbird.selfhosted,dawarich.cluster.netbird.selfhosted,registry.cluster.netbird.selfhosted;
            return 301 https://$server_name$request_uri;
        }
         
    server {
        listen 443 ssl;
        http2 on;
        server_name jellyfin.cluster.netbird.selfhosted;
        
        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        
        # Security headers
        add_header Strict-Transport-Security "max-age=63072000" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        
            # Increase client body size for file uploads
            # 0 for unlimited size
            client_max_body_size 0;
        

        
        
        location / {
            proxy_pass http://jellyfin;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $server_name;
            proxy_set_header X-Forwarded-Port $server_port;

            
            # WebSocket support
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";

            # Use the upgrade mapping variable
            proxy_set_header Connection $connection_upgrade;
        

            
        }
    }
    
 
    server {
        listen 443 ssl;
        http2 on;
        server_name vault.cluster.netbird.selfhosted;
        
        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        
        # Security headers
        add_header Strict-Transport-Security "max-age=63072000" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        

        
        
        location / {
            proxy_pass http://vault;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $server_name;
            proxy_set_header X-Forwarded-Port $server_port;

            

            
        }
    }
    
 
    server {
        listen 443 ssl;
        http2 on;
        server_name gatus_config.cluster.netbird.selfhosted;
        
        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        
        # Security headers
        add_header Strict-Transport-Security "max-age=63072000" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        

        
        
        location / {
            proxy_pass http://gatus_config;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $server_name;
            proxy_set_header X-Forwarded-Port $server_port;

            

            
        }
    }
    
 
    server {
        listen 443 ssl;
        http2 on;
        server_name wikijs.cluster.netbird.selfhosted;
        
        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        
        # Security headers
        add_header Strict-Transport-Security "max-age=63072000" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        

        
        
        location / {
            proxy_pass http://wikijs;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $server_name;
            proxy_set_header X-Forwarded-Port $server_port;

            

            
        }
    }
    
 
    server {
        listen 443 ssl;
        http2 on;
        server_name searxng.cluster.netbird.selfhosted;
        
        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        
        # Security headers
        add_header Strict-Transport-Security "max-age=63072000" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        

        
        
        location / {
            proxy_pass http://searxng;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $server_name;
            proxy_set_header X-Forwarded-Port $server_port;

            

            
        }
    }
    
 
    server {
        listen 443 ssl;
        http2 on;
        server_name dawarich.cluster.netbird.selfhosted;
        
        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        
        # Security headers
        add_header Strict-Transport-Security "max-age=63072000" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        

        
        
        location / {
            proxy_pass http://dawarich;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $server_name;
            proxy_set_header X-Forwarded-Port $server_port;

            

            
        }
    }
    
 
    server {
        listen 443 ssl;
        http2 on;
        server_name registry.cluster.netbird.selfhosted;
        
        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        
        # Security headers
        add_header Strict-Transport-Security "max-age=63072000" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        
            # Increase client body size for file uploads
            # 0 for unlimited size
            client_max_body_size 0;
        

        
            # required to avoid HTTP 411: see Issue #1486 (https://github.com/moby/moby/issues/1486)
            chunked_transfer_encoding on;
        
        
        location / {
            proxy_pass http://registry;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $server_name;
            proxy_set_header X-Forwarded-Port $server_port;

            

            
            if ($http_user_agent ~ "^(docker\/1\.(3|4|5(?!\.[0-9]-dev))|Go ).*$" ) {
                return 404;
            }

            # To add basic authentication to v2 use auth_basic setting.
            auth_basic "Registry realm";
            auth_basic_user_file /etc/nginx/conf.d/nginx.htpasswd;

            ## If $docker_distribution_api_version is empty, the header is not added.
            ## See the map directive above where this variable is defined.
            add_header 'Docker-Distribution-Api-Version' $docker_distribution_api_version always;
        
        }
    }
    
    