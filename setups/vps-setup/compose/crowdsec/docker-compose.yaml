services:
  crowdsec:
    env_file:
      - "../crowdsec.env"
    image: docker.io/crowdsecurity/crowdsec:latest
    container_name: crowdsec
    ports:
      - "127.0.0.1:8080:8080"
    environment:
      - GID=1000
      - COLLECTIONS=crowdsecurity/caddy crowdsecurity/http-cve crowdsecurity/whitelist-good-actors
    volumes:
      - crowdsec-db:/var/lib/crowdsec/data/
      - ./crowdsec-config:/etc/crowdsec/acquis.d
      - caddy-logs:/var/log/caddy:ro
      - /var/log/auth.log:/var/log/auth.log:ro
    networks: [crowdsec, caddy]
    restart: unless-stopped
    security_opt:
      - no-new-privileges=true
  crowdsec-init:
    env_file:
      - "../crowdsec.env"
    image: docker.io/crowdsecurity/crowdsec:latest
    depends_on:
      crowdsec:
        condition: service_healthy
    entrypoint: ["/bin/sh", "-c"]
    networks: [crowdsec]
    restart: "no"

volumes:
  crowdsec-db:
