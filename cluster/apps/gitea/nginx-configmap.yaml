apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-conf
data:
  nginx.conf: |
    user  nginx;
    worker_processes 1;

    events { worker_connections 1024; }

    stream {
      upstream gitea_ssh {
        server gitea.default.svc.cluster.local:2222;
      }
      server {
        listen 22;
        proxy_pass gitea_ssh;
      }
    }

    http {
      upstream gitea_http {
        server gitea.default.svc.cluster.local:3000;
      }
      server {
        listen 80;
        server_name gitea.ts.net;
        location / {
          proxy_pass http://gitea_http;
        }
      }
    }
