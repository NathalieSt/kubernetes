---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: piped
spec:
  interval: 24h
  chartRef:
    kind: HelmChart
    name: piped-chart
  timeout: 10m
  releaseName: piped
  install:
    remediation:
      retries: 3
  values:
    backend:
      enabled: false
    controller:
      enabled: true
    frontend:
      additionalContainers:
        netbird-agent:
          image: netbirdio/netbird:latest
          name: netbird-agent
          env:
          - name: NB_SETUP_KEY
            valueFrom:
              secretKeyRef:
                key: setup-key
                name: netbird-setup-key-vault-secret
          - name: NB_MANAGEMENT_URL
            value: https://netbird.nathalie-stiefsohn.eu
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 100m
              memory: 128Mi
          securityContext:
            privileged: true
      config:
        BACKEND_HOSTNAME: piped-backend.cloud.nathalie-stiefsohn.eu
        PROXY_PART: https://piped-ytproxy.cloud.nathalie-stiefsohn.eu
      env: {}
      podSecurityContext:
        runAsUser: 0
    ingress:
      backend:
        enabled: true
      main:
        enabled: true
      ytproxy:
        enabled: true
    ytproxy:
      enabled: false
