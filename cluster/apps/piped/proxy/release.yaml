---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: piped-ytproxy
spec:
  interval: 24h
  chartRef:
    kind: HelmChart
    name: piped-ytproxy-chart
  timeout: 10m
  releaseName: piped-ytproxy
  install:
    remediation:
      retries: 3
  values:
    backend:
      enabled: false
    frontend:
      enabled: false
    ingress:
      backend:
        enabled: false
      main:
        enabled: false
      ytproxy:
        enabled: false
    ytproxy:
      additionalContainers:
        netbird-agent:
          image: netbirdio/netbird:latest
          name: netbird-agent
          env:
          - name: NB_SETUP_KEY
            valueFrom:
              secretKeyRef:
                key: setup-key
                name: netbird-setup-key-vault-secret
          - name: NB_MANAGEMENT_URL
            value: https://netbird.nathalie-stiefsohn.eu
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 100m
              memory: 128Mi
          securityContext:
            privileged: true
