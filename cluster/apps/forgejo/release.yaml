apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: forgejo
spec:
  releaseName: forgejo
  chartRef:
    kind: OCIRepository
    name: forgejo
  interval: '24h'
  install:
    remediation:
      retries: 3
  timeout: '5m'
  valuesFrom:
  - kind: Secret
    name: postgres-creds-secret
    valuesKey: password
    targetPath: gitea.config.database.PASSWD
    optional: false
  values:
    gitea:
      admin:
        username: Nathi
      config:
        database:
          DB_TYPE: postgres
          HOST: postgres.postgres.svc.cluster.local:5432
          NAME: forgejo
          USER: postgres
        server:
          ROOT_URL: https://code.cluster.netbird.selfhosted
      queue:
        TYPE: redis
        CONN_STR: valkey://valkey.valkey.svc.cluster.local:6379/0?
      cache:
        ADAPTER: redis
        HOST: valkey://valkey.valkey.svc.cluster.local:6379/1
      session:
        PROVIDER: redis
        PROVIDER_CONFIG: valkey://valkey.valkey.svc.cluster.local:6379/2
    persistence:
      enabled: true
      storageClass: nfs-remote
