apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: authelia
spec:
  releaseName: authelia
  chart:
    spec:
      chart: authelia
      version: '0.10.42'
      sourceRef:
        kind: HelmRepository
        name: authelia
      interval: '24h'
  interval: '24h'
  install:
    remediation:
      retries: 3
  timeout: '5m'
  values:
    configMap:
      session:
        cookies:
        - domain: https://netbird.selfhosted
          subdomain: sso.cluster
    secret:
      additionalSecrets:
        postgres-creds-secret:
          items:
          - key: password
            path: postgres-password
        configMap:
          storage:
            postgres:
              enabled: true
              address: tcp://postgres-rw.postgres.svc.cluster.local:5432
              database: authelia
              username: postgres
              password:
                secret_name: postgres-creds-secret
                path: postgres-password
