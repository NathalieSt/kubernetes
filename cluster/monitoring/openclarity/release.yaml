---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: openclarity
spec:
  interval: 24h
  chartRef:
    kind: OCIRepository
    name: openclarity-repo
  timeout: 10m
  releaseName: openclarity
  install:
    remediation:
      retries: 3
  values:
    apiserver:
      database:
        externalPostgresql:
          auth:
            existingSecret: postgres-openclarity-creds-secret
          enabled: true
          host: postgres-rw.postgres.svc.cluster.local
          port: 5432
        postgresql:
          enabled: false
    crDiscoveryServer:
      containerRuntimePaths:
      - name: k0s-containerd
        path: /run/k0s/containerd
        readOnly: true
      - name: k0s-containerd-sock
        path: /run/k0s/containerd.sock
        readOnly: true
      env:
      - name: CONTAINERD_SOCK_ADDRESS
        value: /run/k0s/containerd.sock
    orchestrator:
      provider: kubernetes
      serviceAccount:
        automountServiceAccountToken: true
    postgresql:
      enabled: false
