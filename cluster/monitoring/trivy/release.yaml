---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: trivy
spec:
  interval: 24h
  chartRef:
    kind: HelmChart
    name: trivy-chart
  timeout: 10m
  releaseName: trivy
  install:
    remediation:
      retries: 3
  values:
    alternateReportStorage:
      storageClassName: debian-storage
    operator:
      logDevMode: true
      scanJobPodTemplateContainerSecurityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
          - ALL
        privileged: false
        readOnlyRootFilesystem: false
        runAsGroup: 0
        runAsUser: 0
      scanJobPodTemplateResources:
        limits:
          cpu: "1"
          memory: 1Gi
        requests:
          cpu: 500m
          memory: 512Mi
      scanJobSchedule: 0 */6 * * *
      scanJobsConcurrentLimit: 2
    trivy:
      debug: true
      storageClassName: debian-storage
