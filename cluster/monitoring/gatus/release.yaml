apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: gatus
spec:
  releaseName: gatus
  chart:
    spec:
      chart: gatus
      version: '*'
      sourceRef:
        kind: HelmRepository
        name: gatus
      interval: '24h'
  interval: '24h'
  install:
    remediation:
      retries: 3
  timeout: '5m'
  values:
    persistence:
      enabled: true
    config:
      storage:
        type: sqlite
        path: /data/data.db
      endpoints:
      - enabled: true
        name: jellyfin
        url: http://jellyfin.jellyfin.svc.cluster.local:8096
        group: Cluster Services
        method: GET
        conditions:
        - '[STATUS] == 200'
        interval: '60s'
      - enabled: true
        name: vault
        url: http://vault.vault.svc.cluster.local:8200
        group: Cluster Services
        method: GET
        conditions:
        - '[STATUS] == 200'
        interval: '60s'
      - enabled: true
        name: wikijs
        url: http://wikijs.wikijs.svc.cluster.local:80
        group: Cluster Services
        method: GET
        conditions:
        - '[STATUS] == 200'
        interval: '60s'
      # FIXME: works, but needs to be added to kcl
      - enabled: true
        name: postgres
        url: tcp://postgres-postgresql.postgres.svc.cluster.local:5432
        group: Cluster Services
        conditions:
        - '[CONNECTED] == true'
        interval: '60s'
      - enabled: true
        name: netbird
        url: https://netbird.nathalie-stiefsohn.eu
        group: External Services
        method: GET
        conditions:
        - '[STATUS] == 200'
        interval: '60s'
      - enabled: true
        name: revolt
        url: https://chat.nathalie-stiefsohn.eu
        group: External Services
        method: GET
        conditions:
        - '[STATUS] == 200'
        interval: '60s'
