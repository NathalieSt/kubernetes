---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: vector
spec:
  interval: 24h
  chartRef:
    kind: HelmChart
    name: vector-chart
  timeout: 10m
  releaseName: vector
  install:
    remediation:
      retries: 3
  values:
    customConfig:
      api:
        enabled: false
      data_dir: /var/lib/vector
      sinks:
        es_cluster:
          auth:
            strategy: basic
          endpoints:
          - http://elasticsearch-es-internal-http.elastic-stack.svc.cluster.local:9200
          inputs:
          - k8s_in
          type: elasticsearch
      sources:
        k8s_in:
          type: kubernetes_logs
    role: Agent
    service:
      enabled: false
  valuesFrom:
  - kind: Secret
    name: elastic-search-vector-secret
    valuesKey: password
    targetPath: customConfig.sinks.es_cluster.auth.password
  - kind: Secret
    name: elastic-search-vector-secret
    valuesKey: username
    targetPath: customConfig.sinks.es_cluster.auth.user
